

/***************************************************
 * MADX
 *
 * This madx file is used for:
 * 1) the CNGS beam at injection (14 GeV/c)
 * 2) the CNGS beam during the ramp
 * 3) the CNGS beam at extraction (400 GeV/c)
 * 4) but it is also used for the fixed target beam at injection
 * 5) and for the fixed target beam during the ramp
 *
 * Call the file by: >madx < ft_noqs.madx
 ***************************************************/

 option, echo;



/***************************************************
 * SPECIFY THE SPS BEAM CONFIGURATION, ENERGY and EMITTANCES
 ***************************************************/

 call, file = '../beams/cngs_after_capture.beamx';



/***************************************************
 * files for SPS
 ***************************************************/

 call, file = '../elements/sps.ele';
 call, file = '../aperture/aperturedb_1.dbx';
 call, file = '../aperture/aperturedb_2.dbx';
 call, file = '../sequence/sps.seq';
 call, file = '../aperture/aperturedb_3.dbx';
 call, file = '../strength/ft_noqs.str';
 call, file = '../strength/elements.str';
 option, echo;


/***************************************************
 * SEQEDIT
 ***************************************************/

/*
SEQEDIT, SEQUENCE=SPS;
ENDTT10 : MARKER;
install, element = ENDTT10, at = -0.1375, from = BPH.12008;
ENDEDIT;

SEQEDIT, SEQUENCE=SPS;
ENDVKNV : MARKER;
install, element = ENDVKNV, at = 10.3015+0.1755, from = BPD.11833;
ENDEDIT;

SEQEDIT, SEQUENCE=SPS;
flatten ; cycle, start=  ENDVKNV;
ENDEDIT;
*/



/***************************************************
 * use
 ***************************************************/

 use, sequence=SPS;




/***************************************************
 * TWISS
 ***************************************************/

 set,  format="11.8f";
 set,  format="-18s";

 select, flag=twiss, clear;
!select, flag=twiss
!      , column=name,s,alfx;
 select, flag=twiss
       , column=name,s,x,px,alfx,betx,dx,mux,y,py,alfy,bety,dy,muy;
!select, flag=twiss
!      , column=name,s,x,y,apertype,aper_1,aper_2,aper_3,aper_4;
!select, flag=twiss
!      , column=name,s,x,dx,y,dy;
!select, flag=twiss
!      , column=name,s,l,betx,bety,dx,dy,mux,muy;

 twiss, DELTAP=0.000,  centre;


/***************************************************
 * Write twiss table.
 ***************************************************/

 write,table=twiss,file="../out/optics_ft_noqs.outx";

!write,table=twiss;
!value,table(twiss,SPS$END,dx);






!------------------------------------------
! Aperture file
!------------------------------------------

select, flag=twiss, clear;
select, flag=twiss, range=#S/#E,column=name,s,apertype,aper_1,aper_2;

twiss, DELTAP=0.000, file="../out/aperture.prt";



 stop;





