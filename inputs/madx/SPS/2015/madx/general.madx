!--------------------------------------------------------------------------
! MAD file for SPS optics calculations
!  G.Arduini
!--------------------------------------------------------------------------

 !title, 'Untitled';

 option, echo;
 option, RBARC=FALSE;  ! the length of a rectangular magnet
                       ! is the distance between the polefaces
                       ! and not the arc length
!assign, ECHO=ECHO.PRT;


!---------------------------------------------------------------
!         SPECIFY THE SPS BEAM CONFIGURATION, ENERGY and EMITTANCES
!---------------------------------------------------------------
!call, file = '../beams/cngs_after_capture.beamx';
!call, file = '../beams/lhc_beam_injection.beamx';
 call, file = '../beams/cngs_extraction.beamx';


!--------------------------------------------------------------------------
! call the element definition file for SPS
!--------------------------------------------------------------------------
 call, file = '../elements/sps.ele';


!--------------------------------------------------------------------------
! call the aperture definition file for SPS. These are groups of elements
!--------------------------------------------------------------------------
 call, file = '../aperture/aperturedb_1.dbx';


!--------------------------------------------------------------------------
! aperture of QF1, QF2 and QD
!--------------------------------------------------------------------------
 call, file = '../aperture/aperturedb_2.dbx';


!--------------------------------------------------------------------------
! call the sequence definition file for SPS
!--------------------------------------------------------------------------
 call, file = '../sequence/sps.seq';


!--------------------------------------------------------------------------
! aperture of individual elements
!--------------------------------------------------------------------------
 call, file = '../aperture/aperturedb_3.dbx';


!--------------------------------------------------------------------------
! call the two strength definition files for SPS: *.str & elements.str
!--------------------------------------------------------------------------

!call, file = '../strength/lhc_newwp.str';
 call, file = '../strength/ft_noqs.str';
!call, file = '../strength/ft_noqs_ext.str';
!call, file = '../strength/ft_qs_ext.str';

 call, file = '../strength/elements.str';







USE, period=SPS, range=#S/#E;


!--------------------------------------------------------------------------
! calculates strengths from currents
!--------------------------------------------------------------------------
!call, file = '../cmd/currenttoK.cmdx';


!--------------------------------------------------------------------
! produces twiss file of the whole SPS
!---------------------------------------------------------------------
 call, file = '../cmd/twiss.cmdx';


!--------------------------------------------------------------------
! produces twiss file of the whole SPS, but only for one turn
!---------------------------------------------------------------------
!call, file = '../cmd/twiss_oneturn.cmdx';


!--------------------------------------------------------------------------
! to get the SPS non-linear model
!--------------------------------------------------------------------------
!call, file = '../cmd/nonlinear_model.cmdx';


!--------------------------------------------------------------------------
! to calculate and plot detuning with momentum offset
!--------------------------------------------------------------------------
!call, file = '../cmd/tunevsdp.cmdx';


!--------------------------------------------------------------------------
! Calculate QF & QD strength for given tunes
!--------------------------------------------------------------------------
!call, file = '../cmd/matchtune.cmdx';


!--------------------------------------------------------------------------
! to compute and adjust chromaticity
!--------------------------------------------------------------------------
!call, file = '../cmd/chrom_knob.cmdx';


!--------------------------------------------------------------------------
! direct space charge tune spread
!--------------------------------------------------------------------------
!call, file = '../cmd/scharge.cmdx';


!--------------------------------------------------------------------------
! Matching of LSS4 extraction
!--------------------------------------------------------------------------
!call, file = '../cmd/matchextrlss4.cmdx';


!--------------------------------------------------------------------------
! aperture of individual elements
!--------------------------------------------------------------------------
!call, file = '../cmd/aperture.cmdx';


!--------------------------------------------------------------------------
! LSS1 Quadrupole Displacement for Beam Dumping
!--------------------------------------------------------------------------
!call, file = '../cmd/lss1_q171819_displacement.madx';

sixtrack, cavall, radius = 0.017;
stop;






